<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gradient Generator</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #222;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      min-height: 100vh;
      padding: 20px;
    }

    .controls {
      width: 100%;
      max-width: 400px;
      display: flex;
      flex-direction: column; /* 세로 정렬 */
      align-items: flex-start; /* 왼쪽 정렬 */
      justify-content: start;
      gap: 15px; /* 각 옵션 사이에 간격 추가 */
      margin-bottom: 20px; /* 아래에 여백 추가 */
    }

    label {
      font-size: 14px;
      margin-bottom: 5px;
    }

    input, button {
      width: 100%; /* 가로 너비를 100%로 지정 */
      padding: 10px;
      box-sizing: border-box;
      font-size: 14px;
    }

    button {
      cursor: pointer;
      font-weight: bold;
      background-color: #444;
      color: white;
      border: 1px solid #555;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #555;
    }

    canvas {
      background-color: #000;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.5);
      width: 90%;
      max-width: 90vw;
      height: auto;
      max-height: 70vh;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="controls">
    <div>
      <label for="resolution">해상도 (ex: 1920x1080):</label>
      <input type="text" id="resolution" value="1920x1080">
    </div>

    <div>
      <label for="colors">색상 단계:</label>
      <input type="number" id="colors" value="5" min="2" max="20">
    </div>

    <div>
      <label for="grainSize">입자 굵기:</label>
      <input type="number" id="grainSize" value="1" min="1" max="10">
    </div>

    <div>
      <label for="angle">각도 (0~360):</label>
      <input type="number" id="angle" value="45" min="0" max="360">
    </div>

    <div>
      <button onclick="generateGradient()">그라디언트 생성</button>
      <button onclick="downloadImage()">JPG 저장</button>
    </div>
  </div>

  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // 기본값 설정
    let resolution = [1920, 1080];
    let colorCount = 5;
    let grainSize = 1;
    let angle = 45;

    // 캔버스 크기 초기화
    function resizeCanvasToResolution() {
      const resolutionInput = document.getElementById('resolution').value;
      const [width, height] = resolutionInput.split('x').map(Number);

      // 유효하지 않은 값일 경우 기본값 사용
      resolution = [
        width > 0 ? width : 1920,
        height > 0 ? height : 1080,
      ];
      canvas.width = resolution[0];
      canvas.height = resolution[1];

      console.log(`Canvas resized to: ${canvas.width}x${canvas.height}`);
    }

    // 색상 팔레트 생성
    function generateRandomColors(count) {
      const colors = [];
      for (let i = 0; i < count; i++) {
        const r = Math.floor(Math.random() * 255);
        const g = Math.floor(Math.random() * 255);
        const b = Math.floor(Math.random() * 255);
        colors.push(`rgb(${r},${g},${b})`);
      }
      return colors;
    }

    // 그라디언트 생성
    function generateGradient() {
      resizeCanvasToResolution();

      const colorsInput = document.getElementById('colors').value;
      const grainInput = document.getElementById('grainSize').value;
      const angleInput = document.getElementById('angle').value;

      colorCount = Math.max(2, Math.min(Number(colorsInput), 20));
      grainSize = Math.max(1, Math.min(Number(grainInput), 10));
      angle = Math.max(0, Math.min(Number(angleInput), 360));

      const colors = generateRandomColors(colorCount);
      const radians = (angle * Math.PI) / 180;

      // 시작점과 끝점 계산
      const x0 = canvas.width / 2 - (canvas.width / 2) * Math.cos(radians);
      const y0 = canvas.height / 2 - (canvas.height / 2) * Math.sin(radians);
      const x1 = canvas.width / 2 + (canvas.width / 2) * Math.cos(radians);
      const y1 = canvas.height / 2 + (canvas.height / 2) * Math.sin(radians);

      const gradient = ctx.createLinearGradient(x0, y0, x1, y1);
      const step = 1 / (colors.length - 1);
      colors.forEach((color, index) => {
        gradient.addColorStop(index * step, color);
      });

      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      generateGrain();

      console.log('Gradient generated successfully.');
    }

    // Grain 효과 추가
    function generateGrain() {
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;

      for (let i = 0; i < data.length; i += 4 * grainSize) {
        const grain = Math.random() * 40 - 20;
        data[i] = Math.min(255, Math.max(0, data[i] + grain)); // R
        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + grain)); // G
        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + grain)); // B
      }

      ctx.putImageData(imageData, 0, 0);
    }

    // 이미지 저장
    function downloadImage() {
      const link = document.createElement('a');
      link.download = 'gradient.jpg';
      link.href = canvas.toDataURL('image/jpeg');
      link.click();
    }

    // 초기화
    generateGradient();
  </script>
</body>
</html>